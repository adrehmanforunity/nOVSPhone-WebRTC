<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Call Application with Device Selection</title>
    <script type="text/javascript" src="https://dtd6jl0d42sve.cloudfront.net/lib/SipJS/sip-0.20.0.min.js" defer="true"></script>
</head>
<body>
    <button id="permissionButton">Grant Permission</button>

    <label for="audioInputSelect">Audio Input Device:</label>
    <select id="audioInputSelect"></select>

    <label for="audioOutputSelect">Audio Output Device:</label>
    <select id="audioOutputSelect"></select>

    <audio id="localAudio" autoplay></audio>
    <audio id="remoteAudio" autoplay></audio>

    <button id="callButton">Call *43</button>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var audioInputSelect = document.getElementById('audioInputSelect');
            var audioOutputSelect = document.getElementById('audioOutputSelect');

            // Function to request permission and populate the device selection dropdowns
            function getPermissionAndUpdateDevices() {
                navigator.mediaDevices.getUserMedia({ audio: true, video: false })
                    .then(function(stream) {
                        // Now that we have permission, update the device selections
                        updateDeviceSelection();
                        // Stop all tracks to ensure no audio is playing after permission is granted
                        stream.getTracks().forEach(function(track) {
                            track.stop();
                        });
                    })
                    .catch(function(error) {
                        console.error('Error accessing media devices.', error);
                    });
            }

            // Function to populate the device selection dropdowns
            function updateDeviceSelection() {
                navigator.mediaDevices.enumerateDevices()
                    .then(function(devices) {
                        audioInputSelect.innerHTML = '';
                        audioOutputSelect.innerHTML = '';
                        devices.forEach(function(device) {
                            var option = document.createElement('option');
                            option.value = device.deviceId;
                            option.text = device.label || 'Device ' + (device.deviceId.substr(0, 6)) + '...';
                            if (device.kind === 'audioinput') {
                                audioInputSelect.appendChild(option);
                            } else if (device.kind === 'audiooutput') {
                                audioOutputSelect.appendChild(option);
                            }
                        });
                    });
            }

            document.getElementById('permissionButton').addEventListener('click', getPermissionAndUpdateDevices);

            // Rest of your existing code...
        });
    </script>
</body>
</html>
