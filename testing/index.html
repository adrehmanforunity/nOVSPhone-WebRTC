<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Call Application with Device Selection and Registration</title>
    <script type="text/javascript" src="https://dtd6jl0d42sve.cloudfront.net/lib/SipJS/sip-0.20.0.min.js" defer="true"></script>
</head>
<body>
    <button id="permissionButton">Grant Permission</button>

    <label for="audioInputSelect">Audio Input Device:</label>
    <select id="audioInputSelect"></select>

    <label for="audioOutputSelect">Audio Output Device:</label>
    <select id="audioOutputSelect"></select>

    <audio id="localAudio" autoplay></audio>
    <audio id="remoteAudio" autoplay></audio>

    <button id="registerButton">Register</button>
    <button id="unregisterButton">Unregister</button>
    <button id="callButton">Call *43</button>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var SipUsername = '2001';
            var SipPassword = 'ab0000';
            var SipDomain = 'webrtc.kozow.com';
            var audioInputSelect = document.getElementById('audioInputSelect');
            var audioOutputSelect = document.getElementById('audioOutputSelect');
            var userAgent;
            var registerer;
            var registered = false;

            // ... rest of your existing code ...

            document.getElementById('registerButton').addEventListener('click', function () {
                if (!userAgent) {
                    var userAgentOptions = {
                        uri: SIP.UserAgent.makeURI("sip:" + SipUsername + "@" + SipDomain),
                        transportOptions: {
                            server: 'wss://' + SipDomain + ':4443/ws',
                            traceSip: true
                        },
                        authorizationUsername: SipUsername,
                        authorizationPassword: SipPassword,
                        sessionDescriptionHandlerFactoryOptions: {
                            constraints: {
                                audio: true,
                                video: false
                            }
                        },
                        iceServers: [
                            { urls: 'stun:stun.l.google.com:19302' }
                        ]
                    };

                    userAgent = new SIP.UserAgent(userAgentOptions);
                    registerer = new SIP.Registerer(userAgent);

                    userAgent.start().then(() => {
                        console.log('User agent started');
                        registerer.register();
                    }).catch(error => {
                        console.error('Error starting user agent:', error);
                    });
                } else if (!registered) {
                    registerer.register();
                }
            });

            document.getElementById('unregisterButton').addEventListener('click', function () {
                if (registerer && registered) {
                    registerer.unregister();
                }
            });

            // ... rest of your existing code ...
        });
    </script>
</body>
</html>
